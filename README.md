# EasyFit — Документация проекта

## Оглавление

- [1. Структура проекта](#1-структура-проекта)
- [2. Схемы работы](#2-схемы-работы)
- [3. Backend: принцип работы и функции](#3-backend-принцип-работы-и-функции)
- [4. Базы данных и обоснование выбора](#4-базы-данных-и-обоснование-выбора)
- [5. Функционал приложения](#5-функционал-приложения)
- [6. UX/UI дизайн](#6-uxui-дизайн)

---

## 1. Структура проекта

### Тип архитектуры: модульный монолит

Приложение EasyFit построено по принципу **модульного монолита** — это единое приложение, где весь код backend-а работает в одном процессе Node.js, но логически разделён на независимые модули (маршруты, мидлвары, слой данных).

**Почему не микросервисы:**
- Масштаб проекта не требует разделения на отдельные сервисы — один бэкенд обслуживает все функции (авторизация, тренировки, упражнения, сообщество, вода)
- Единый процесс = простота развёртывания (один PM2-процесс), отладки и поддержки
- Нет межсервисной коммуникации — все модули обращаются к одной БД PostgreSQL напрямую через общий пул соединений
- Для текущей нагрузки (один сервер, один разработчик) микросервисы добавили бы ненужную сложность

**Почему не чистый монолит:**
- Код разделён на **изолированные модули** — каждый маршрут (`auth.js`, `workouts.js`, `exercises.js`, `community.js`) самодостаточен и не зависит от других
- Мидлвар авторизации вынесен отдельно и подключается декларативно
- Слой данных (pool, create, seed) отделён от бизнес-логики
- При необходимости любой модуль можно вынести в отдельный микросервис без переписывания остальных

**Структура монолита:**

```
Express (один процесс)
├── /api/auth         ← модуль авторизации
├── /api/workouts     ← модуль тренировок + вода + синхронизация
├── /api/exercises    ← модуль каталога упражнений
├── /api/community    ← модуль сообщества
├── middleware/auth    ← общий мидлвар
└── db/pool           ← общий пул соединений PostgreSQL
```

**На стороне клиента** применяется аналогичный подход: единое React Native приложение с модульным разделением на слой данных (`data/`), компоненты (`components/`), экраны (`app/`) и хуки (`hooks/`).

### Общая архитектура

| Слой | Технология |
|---|---|
| Frontend | Expo SDK 54, React Native 0.81.5, TypeScript, React 19 |
| Backend | Node.js, Express 4 |
| Серверная БД | PostgreSQL 14 (pg) |
| Локальная БД | SQLite (expo-sqlite) |
| Аутентификация | JWT (30 дней), bcrypt |
| Обработка изображений | Sharp (серверная обрезка/ресайз аватарок) |
| API хост | `http://89.111.171.11/api` |
| Android-пакет | `com.rifitgg.EasyFit` |

### Дерево файлов

```
Fit-app/
├── app/                          # Экраны приложения (Expo Router)
│   ├── _layout.tsx               # Корневой layout (провайдеры, навигация)
│   ├── (tabs)/                   # Вкладки
│   │   ├── _layout.tsx           # Конфигурация таб-бара (5 вкладок)
│   │   ├── index.tsx             # Главная — дашборд, статистика, авторизация
│   │   ├── exercises.tsx         # Каталог упражнений с поиском и фильтрами
│   │   ├── explore.tsx           # Список тренировок пользователя
│   │   ├── calendar.tsx          # Календарь, планирование тренировок
│   │   ├── community.tsx         # Сообщество — опубликованные тренировки
│   │   └── profile.tsx           # Профиль, настройки, смена темы
│   ├── exercise/
│   │   └── [id].tsx              # Детальная страница упражнения
│   └── workout/
│       ├── create.tsx            # Создание тренировки
│       ├── [id].tsx              # Просмотр тренировки
│       └── run.tsx               # Выполнение тренировки (таймер, подходы)
│
├── backend/                      # Серверная часть
│   ├── src/
│   │   ├── index.js              # Точка входа Express-сервера
│   │   ├── middleware/
│   │   │   └── auth.js           # JWT-мидлвар авторизации
│   │   ├── routes/
│   │   │   ├── auth.js           # Регистрация, логин, профиль, аватар
│   │   │   ├── workouts.js       # Тренировки, логи, расписание, синхронизация, вода
│   │   │   ├── exercises.js      # Каталог упражнений (CRUD, фильтры)
│   │   │   └── community.js      # Публикация, лайки, копирование тренировок
│   │   └── db/
│   │       ├── pool.js           # Подключение к PostgreSQL              
│   └── uploads/
│       └── avatars/              # Загруженные аватарки пользователей
│
├── components/                   # Переиспользуемые UI-компоненты
│   ├── animated-components.tsx   # FadeInView, ScalePressable, ProgressRing, AnimatedCounter
│   ├── avatar-crop-modal.tsx     # Модалка кадрирования аватара
│   ├── badge.tsx                 # Бейджи: группа мышц, снаряжение, сложность
│   ├── button.tsx                # Стилизованная кнопка
│   ├── chip-filter.tsx           # Горизонтальные фильтры-чипы
│   ├── exercise-card.tsx         # Карточка упражнения в списке
│   ├── exercise-icons.tsx        # SVG-иконки упражнений и мышц
│   ├── glass-card.tsx            # Glass-morphism карточка-контейнер
│   ├── haptic-tab.tsx            # Кнопка таб-бара с тактильным откликом
│   ├── icons.tsx                 # Библиотека SVG-иконок (40+)
│   ├── intro-screen.tsx          # Анимированный сплэш-скрин
│   ├── search-bar.tsx            # Поисковая строка
│   └── ...                       # themed-text, themed-view, parallax-scroll-view
│
├── data/                         # Слой данных
│   ├── api.ts                    # HTTP-клиент, все API-вызовы
│   ├── auth-context.tsx          # React-контекст авторизации
│   ├── database.ts               # Локальная SQLite (таблицы, CRUD)
│   ├── database.web.ts           # Веб-заглушка SQLite (in-memory maps)
│   ├── storage.ts                # Offline-first слой (API + локальная БД)
│   ├── sync.ts                   # Двунаправленная синхронизация
│   ├── types.ts                  # TypeScript-типы и интерфейсы
│   ├── exercises.ts              # Загрузка и кэширование упражнений
│   ├── calories.ts               # Калькулятор калорий
│   ├── water.ts                  # Трекер воды (формула, стаканы)
│   ├── notifications.ts          # Локальные уведомления (expo-notifications)
│   ├── theme-context.tsx         # Контекст темы (system/light/dark)
│   └── storage.ts                # Offline-first обёртка над API+SQLite
│
├── constants/
│   └── theme.ts                  # Цветовые палитры, отступы, скругления
│
├── hooks/                        # Кастомные хуки
│   ├── use-color-scheme.ts       # Определение текущей темы
│   └── use-theme-color.ts        # Получение цвета из палитры
│
├── plugins/
│   └── network-config.js         # Expo config plugin: разрешение HTTP-трафика
│
├── landing/                      # Лендинг-страница (HTML/CSS/JS)
│
├── app.json                      # Конфигурация Expo
├── eas.json                      # Конфигурация EAS Build (preview=APK, production=AAB)
├── package.json                  # Зависимости frontend
├── metro.config.js               # Конфигурация Metro bundler
└── tsconfig.json                 # TypeScript
```

### Навигация по экранам

Приложение использует **Expo Router** (file-based routing) со стек-навигатором и таб-навигатором:

| Вкладка | Экран | Описание |
|---|---|---|
| 🏠 Главное | `(tabs)/index.tsx` | Дашборд: приветствие, прогресс, статистика, авторизация |
| 💪 Упражнения | `(tabs)/exercises.tsx` | Каталог 82 упражнений с поиском и фильтрами |
| 📋 Тренировки | `(tabs)/explore.tsx` | Мои тренировки: создание, удаление, публикация |
| 📅 Календарь | `(tabs)/calendar.tsx` | Помесячный календарь, планирование, история |
| 🌍 Сообщество | `(tabs)/community.tsx` | Тренировки от других пользователей, лайки |

Модальные/стековые экраны:
- `exercise/[id]` — детали упражнения (card-анимация)
- `workout/create` — создание тренировки (модалка)
- `workout/[id]` — просмотр тренировки
- `workout/run` — выполнение (fullScreenModal, без возможности свайпнуть)
- `profile` — профиль пользователя

---

## 2. Схемы работы

### 2.1. Общая архитектура (клиент-сервер)

```
┌─────────────────────────────────────────────────────────┐
│                  React Native (Expo)                    │
│                                                         │
│  ┌──────────┐   ┌──────────┐   ┌────────────────────┐  │
│  │ Экраны   │──▶│ Storage  │──▶│  SQLite (fitapp.db) │  │
│  │ (Router) │   │ Layer    │   │  • exercises        │  │
│  └──────────┘   │          │   │  • workouts         │  │
│       │         │ offline- │   │  • workout_logs     │  │
│       │         │ first    │   │  • scheduled        │  │
│       ▼         │          │   │  • sync_queue       │  │
│  ┌──────────┐   └────┬─────┘   └────────────────────┘  │
│  │ Contexts │        │                                  │
│  │ Auth /   │        │ HTTP (REST JSON)                 │
│  │ Theme    │        ▼                                  │
│  └──────────┘   ┌──────────┐                            │
│                 │ api.ts   │                             │
│                 │ apiFetch │                             │
│                 └────┬─────┘                             │
│                      │                                  │
│                 ┌────▼─────┐                             │
│                 │ sync.ts  │  push + pull                │
│                 └──────────┘                             │
└───────────────────────┬─────────────────────────────────┘
                        │ REST API (JSON)
                        ▼
┌─────────────────────────────────────────────────────────┐
│              Express Backend (Node.js)                  │
│                                                         │
│  Nginx (80) ──▶ Node.js (3000)                         │
│                                                         │
│  /api/auth       — регистрация, логин, профиль          │
│  /api/workouts   — тренировки, логи, расписание, вода   │
│  /api/exercises  — каталог упражнений                   │
│  /api/community  — публикация, лайки                    │
│                                                         │
│  ┌──────────────────────────────────────────────────┐   │
│  │              PostgreSQL 14                       │   │
│  │  users, exercises, workouts, workout_logs,       │   │
│  │  scheduled_workouts, published_workouts,         │   │
│  │  water_intake, ...                               │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### 2.2. Offline-first паттерн (запись данных)

```
Пользователь создаёт тренировку
         │
         ▼
┌─────────────────────┐
│ 1. Сохранить в SQLite │ ◀── всегда выполняется первым
└─────────┬───────────┘
          │
          ▼
┌─────────────────────┐     ┌──────────────────────────┐
│ 2. Отправить на API │──▶  │  Успех: данные на сервере │
└─────────┬───────────┘     └──────────────────────────┘
          │
          │ Ошибка (нет сети)
          ▼
┌──────────────────────┐
│ 3. Добавить в        │
│    sync_queue         │ ◀── повторит при следующей синхронизации
└──────────────────────┘
```

### 2.3. Синхронизация (Sync)

```
Триггер: запуск приложения / логин / фокус на главном экране
         │
         ▼
┌──────────────────────────────┐
│ 1. Прочитать sync_queue      │  (локальные оффлайн-мутации)
│    из SQLite                 │
└─────────┬────────────────────┘
          │
          ▼
┌──────────────────────────────┐
│ 2. POST /api/workouts/sync   │  отправляем actions[] + lastSync
│    на сервер                 │
└─────────┬────────────────────┘
          │
          ▼ Ответ сервера: полное состояние
┌──────────────────────────────┐
│ 3. Очистить sync_queue       │
│    (обработанные записи)     │
└─────────┬────────────────────┘
          │
          ▼
┌──────────────────────────────┐
│ 4. Merge: серверные данные   │  Стратегия: server-wins
│    → перезаписать SQLite     │  (удалить лишние, upsert все)
└─────────┬────────────────────┘
          │
          ▼
┌──────────────────────────────┐
│ 5. Сохранить lastSyncTime    │
└──────────────────────────────┘
```

**Стратегия:** после того как оффлайн-очередь отправлена, сервер считается авторитетным источником. Его данные перезаписывают локальные.

### 2.4. Аутентификация

```
                    Запуск приложения
                          │
                          ▼
                 ┌──────────────────┐
                 │ Есть токен в     │
                 │ AsyncStorage?    │
                 └────┬────────┬────┘
                      │        │
                  Да  │        │ Нет
                      ▼        ▼
           ┌─────────────┐  ┌─────────────────┐
           │ Загрузить    │  │  Гостевой режим  │
           │ кэш. юзера  │  │  (без данных)    │
           └──────┬──────┘  └─────────────────┘
                  │
                  ▼
           ┌─────────────┐
           │ GET /auth/me │
           └──────┬──────┘
                  │
            ┌─────┴──────┐
            │            │
         Успех        Ошибка
            │            │
            ▼            ▼
     ┌────────────┐  ┌─────────────────────┐
     │ Обновить   │  │ Есть кэш. юзер?     │
     │ юзера +    │  │ Да → остаться        │
     │ запустить  │  │      залогиненным    │
     │ sync       │  │ Нет → разлогинить    │
     └────────────┘  └─────────────────────┘
```

### 2.5. Выполнение тренировки

```
Экран workout/run.tsx
         │
         ▼
┌─────────────────────────┐
│ Загрузить тренировку     │  (из кэша упражнений)
│ и её упражнения          │
└─────────┬───────────────┘
          │
          ▼
┌─────────────────────────┐
│ Фаза: УПРАЖНЕНИЕ        │◀─────────────────┐
│ Показать подход #N       │                  │
│ [✓ Завершить] [✗ Пропуск]│                  │
└─────────┬───────────────┘                  │
          │                                   │
          ▼                                   │
┌─────────────────────────┐                  │
│ Фаза: ОТДЫХ              │                  │
│ Таймер обратного отсчёта │                  │
│ (restSeconds)            │                  │
└─────────┬───────────────┘                  │
          │                                   │
          ▼                                   │
     Ещё подходы / упражнения? ──── Да ───────┘
          │
          │ Нет
          ▼
┌─────────────────────────┐
│ Сохранить WorkoutLog     │
│ • в SQLite (локально)    │
│ • на сервер (API)        │
│ Калории рассчитываются   │
│ автоматически            │
└─────────────────────────┘
```

---

## 3. Backend: принцип работы и функции

### 3.1. Точка входа (index.js)

Express-сервер слушает порт 3000 на `0.0.0.0`. Nginx проксирует с порта 80.

```
Nginx (80) ──proxy_pass──▶ Node.js (3000)
```

**Маршруты:**
- `/api/auth` — аутентификация и пользователь
- `/api/workouts` — тренировки, логи, расписание, синхронизация, вода
- `/api/exercises` — каталог упражнений
- `/api/community` — публикация и социальные функции
- `/api/health` — проверка состояния сервера
- `/uploads` — статическая раздача файлов (аватарки)

### 3.2. Мидлвар авторизации (middleware/auth.js)

- `generateToken(userId)` — создаёт JWT с секретом из env `JWT_SECRET`, срок действия 30 дней
- `authMiddleware(req, res, next)` — проверяет заголовок `Authorization: Bearer <token>`, декодирует JWT, устанавливает `req.userId`

### 3.3. API-эндпоинты

#### Аутентификация (`/api/auth`)

| Метод | Путь | Авторизация | Описание |
|---|---|---|---|
| `POST` | `/auth/register` | Нет | Регистрация (email, пароль от 6 символов, имя). Возвращает юзера + JWT |
| `POST` | `/auth/login` | Нет | Вход по email/паролю. Возвращает юзера + JWT |
| `GET` | `/auth/me` | Да | Получить текущий профиль |
| `PUT` | `/auth/profile` | Да | Обновить поля профиля (имя, рост, вес, дата рождения, цель) |
| `POST` | `/auth/avatar` | Да | Загрузка аватарки (multipart, макс 5 МБ). Опционально кроп. Ресайз 400×400 JPEG |
| `POST` | `/auth/avatar/crop` | Да | Перекадрировать ранее загруженный оригинал |
| `PUT` | `/auth/password` | Да | Смена пароля (требуется текущий пароль) |

**Поля пользователя:** `id, email, name, avatar_url, avatar_original_url, height_cm, weight_kg, birth_date, goal, created_at`

#### Тренировки (`/api/workouts`)

| Метод | Путь | Авторизация | Описание |
|---|---|---|---|
| `GET` | `/workouts` | Да | Список тренировок пользователя с упражнениями |
| `POST` | `/workouts` | Да | Создать/обновить тренировку (поддержка клиентского `id`) |
| `DELETE` | `/workouts/:id` | Да | Удалить тренировку |
| `POST` | `/workouts/logs` | Да | Сохранить лог завершённой тренировки |
| `GET` | `/workouts/logs` | Да | Получить логи (лимит 100, по убыванию дат) |
| `GET` | `/workouts/stats` | Да | Агрегированная статистика (всего/неделя/сегодня, минуты, калории) |
| `GET` | `/workouts/scheduled` | Да | Список запланированных тренировок (только будущие) |
| `POST` | `/workouts/scheduled` | Да | Создать расписание тренировки |
| `DELETE` | `/workouts/scheduled/:id` | Да | Удалить расписание |
| `POST` | `/workouts/sync` | Да | **Двунаправленная синхронизация** — обработка оффлайн-очереди, возврат полного состояния |
| `GET` | `/workouts/water` | Да | Потребление воды за дату |
| `GET` | `/workouts/water/week` | Да | Потребление воды за неделю (Пн-Вс) |
| `POST` | `/workouts/water` | Да | Установить потребление воды (стаканы + цель) |

#### Упражнения (`/api/exercises`)

| Метод | Путь | Авторизация | Описание |
|---|---|---|---|
| `GET` | `/exercises` | Нет | Список упражнений с фильтрами (мышцы, снаряд, сложность, поиск) |
| `GET` | `/exercises/:id` | Нет | Детали упражнения с пошаговой инструкцией |

#### Сообщество (`/api/community`)

| Метод | Путь | Авторизация | Описание |
|---|---|---|---|
| `POST` | `/community/publish` | Да | Опубликовать тренировку (название, описание, сложность) |
| `PUT` | `/community/:id` | Да | Редактировать свою публикацию |
| `DELETE` | `/community/:id` | Да | Удалить свою публикацию |
| `GET` | `/community` | Нет | Список публикаций (сортировка, фильтр, пагинация) |
| `GET` | `/community/:id` | Нет | Детали публикации (увеличивает счётчик просмотров) |
| `POST` | `/community/:id/like` | Да | Поставить/убрать лайк |
| `POST` | `/community/:id/copy` | Да | Скопировать тренировку себе |
| `GET` | `/community/my/list` | Да | Мои публикации |

### 3.4. Серверная логика синхронизации (`POST /workouts/sync`)

1. Принимает массив `actions[]` — каждый action содержит `entity` (workout/workout_log/scheduled), `entity_id`, `action` (create/delete), `payload`
2. Обрабатывает каждый action:
   - `create workout` → INSERT OR UPDATE тренировки + упражнения
   - `delete workout` → DELETE тренировки
   - `create workout_log` → INSERT лога + упражнения + подходы
   - `create scheduled` → INSERT расписания
   - `delete scheduled` → DELETE расписания
3. Возвращает полное текущее состояние: все тренировки, логи и расписание (с фильтром `date >= CURRENT_DATE` для расписания)
4. Возвращает `serverTime` для следующего цикла синхронизации

---

## 4. Базы данных и обоснование выбора

### 4.1. Почему две базы данных?

Проект использует **двухуровневую архитектуру хранения:**

| | PostgreSQL (сервер) | SQLite (клиент) |
|---|---|---|
| **Где** | Ubuntu 22.04 (89.111.171.11) | Устройство пользователя |
| **Зачем** | Единый источник правды, межустройственная синхронизация | Мгновенный доступ, работа без интернета |
| **Когда** | При наличии сети | Всегда |

### 4.2. PostgreSQL — серверная БД

**Почему PostgreSQL, а не MySQL/MongoDB:**

1. **Типизация данных** — используются кастомные ENUM-типы (`equipment_type`, `difficulty_level`, `muscle_group`), которые обеспечивают целостность на уровне БД
2. **JSON-агрегация** — `json_agg()`, `json_build_object()` для сборки вложенных объектов (тренировка → упражнения → подходы) в одном SQL-запросе
3. **UUID** — нативная поддержка `uuid_generate_v4()` через расширение `uuid-ossp`
4. **Надёжность** — ACID-транзакции для операций синхронизации, где нужно атомарно обработать несколько действий
5. **Производительность** — индексы на `user_id`, `date`, `created_at DESC` для быстрых выборок

**Кастомные ENUM-типы:**

```sql
CREATE TYPE equipment_type AS ENUM (
  'barbell', 'dumbbell', 'cable', 'machine',
  'bodyweight', 'kettlebell', 'bands'
);

CREATE TYPE difficulty_level AS ENUM (
  'beginner', 'intermediate', 'advanced'
);

CREATE TYPE muscle_group AS ENUM (
  'chest', 'back', 'shoulders', 'biceps', 'triceps',
  'legs', 'glutes', 'abs', 'forearms', 'calves'
);
```

**Схема таблиц (PostgreSQL):**

```
users
├── id: UUID (PK, auto-generated)
├── email: VARCHAR(255) UNIQUE
├── password_hash: VARCHAR(255)
├── name: VARCHAR(100)
├── avatar_url / avatar_original_url: TEXT
├── height_cm: INTEGER
├── weight_kg: REAL
├── birth_date: DATE
├── goal: TEXT
└── created_at: TIMESTAMPTZ

exercises
├── id: VARCHAR(64) (PK, slug)
├── name: VARCHAR(200)
├── equipment: equipment_type (ENUM)
├── difficulty: difficulty_level (ENUM)
└── description: TEXT

exercise_muscles
├── exercise_id → exercises.id
└── muscle_group: muscle_group (ENUM)

exercise_steps
├── exercise_id → exercises.id
├── step_order: INTEGER
└── text: TEXT

workouts
├── id: TEXT (PK, UUID от клиента)
├── user_id → users.id
└── name: VARCHAR(200)

workout_exercises
├── workout_id → workouts.id
├── exercise_id: VARCHAR(64)
├── exercise_order: INTEGER
├── sets / reps / rest_seconds: INTEGER

scheduled_workouts
├── id: TEXT (PK, UUID от клиента)
├── user_id → users.id
├── workout_id → workouts.id
├── workout_name: VARCHAR(200)
├── date: DATE
└── time: VARCHAR(10)

workout_logs
├── id: TEXT (PK, UUID от клиента)
├── user_id → users.id
├── workout_id / workout_name
├── date: DATE
├── started_at / completed_at: TIMESTAMPTZ
└── duration_minutes: INTEGER

workout_log_exercises → completed_sets
  (каскадное удаление)

published_workouts
├── id: UUID (PK)
├── workout_id → workouts.id
├── user_id → users.id
├── title, description, difficulty
├── views / likes_count: INTEGER
└── created_at: TIMESTAMPTZ

published_workout_likes (user_id, published_id)

water_intake
├── user_id + date (PK)
├── glasses: INTEGER
├── target_ml: INTEGER
└── updated_at: TIMESTAMPTZ
```

### 4.3. SQLite — клиентская БД

**Почему SQLite:**

1. **Встроена в expo-sqlite** — нативный модуль, работает без дополнительных серверов
2. **Мгновенный отклик** — все чтения из локальной БД (0 мс задержки сети)
3. **Offline-first** — приложение полностью работоспособно без интернета
4. **Синхронизация** — таблица `sync_queue` хранит оффлайн-мутации до отправки на сервер
5. **Лёгкость** — один файл `fitapp.db` на устройстве

**Схема SQLite (зеркалирует серверную):**

```sql
exercises (id, name, equipment, difficulty, description)
exercise_muscles (exercise_id, muscle_group)
exercise_steps (exercise_id, step_order, text)
workouts (id, name, created_at)
workout_exercises (workout_id, position, exercise_id, sets, reps, rest_seconds)
workout_logs (id, workout_id, workout_name, date, started_at, completed_at, duration_minutes)
log_exercises (log_id, position, exercise_id, target_sets, target_reps, rest_seconds)
log_sets (log_id, exercise_position, set_index, reps, completed)
scheduled_workouts (id, workout_id, workout_name, date, time)
sync_queue (id, entity, entity_id, action, payload, created_at)
sync_meta (key, value)  -- last_user_id, lastSyncTime
```

### 4.4. Разделение ответственности

```
┌──────────────────────────────────────────────────────┐
│                Слои хранения данных                   │
│                                                      │
│   Экраны (UI)                                        │
│      │                                               │
│      ▼                                               │
│   storage.ts  ─── «Единый API для данных»            │
│      │                                               │
│      ├──▶ database.ts (SQLite) ── всегда пишет сюда  │
│      │                                               │
│      ├──▶ api.ts (HTTP) ── пытается отправить        │
│      │       │                                       │
│      │       └── Ошибка? ──▶ sync_queue (SQLite)     │
│      │                                               │
│      └──▶ sync.ts ── периодическая синхронизация     │
│              │                                       │
│              └── POST /workouts/sync (сервер)        │
│                     │                                │
│                     ▼                                │
│              PostgreSQL (источник правды)             │
└──────────────────────────────────────────────────────┘
```

---

## 5. Функционал приложения

### 5.1. Калькулятор ИМТ (BMI)

**Формула:**

$$BMI = \frac{weight_{kg}}{(height_{cm} / 100)^2}$$

**Реализация** (вычисляется в `app/(tabs)/index.tsx`):

```typescript
const bmi = user?.height_cm && user?.weight_kg
  ? user.weight_kg / ((user.height_cm / 100) ** 2)
  : null;
```

**Категории:**

| ИМТ | Категория | Цвет |
|---|---|---|
| < 18.5 | Недостаточный вес | 🔵 `#60A5FA` |
| 18.5–24.9 | Норма | 🟢 `#34D399` |
| 25–29.9 | Избыточный вес | 🟡 `#FBBF24` |
| ≥ 30 | Ожирение | 🔴 `#F87171` |

**Где используется:**
- Отображается на главном экране (дашборд) при заполненных росте и весе
- Влияет на расчёт рекомендуемого потребления воды (см. п. 5.2)

### 5.2. Подсчёт воды

**Файл:** `data/water.ts`

#### Формула рекомендуемого потребления

$$water_{ml} = weight_{kg} \times 30$$

С корректировками:
- Если $BMI \geq 30$: $+500$ мл (ожирение)
- Если $25 \leq BMI < 30$: $+250$ мл (лишний вес)
- Если $height_{cm} > 180$: $+200$ мл (высокий рост)
- Округление до ближайших 50 мл
- Ограничение: $[1500, 4500]$ мл

**Реализация:**

```typescript
function calculateDailyWaterMl(weightKg: number, heightCm: number, bmi: number): number {
  let ml = weightKg * 30;
  if (bmi >= 30) ml += 500;
  else if (bmi >= 25) ml += 250;
  if (heightCm > 180) ml += 200;
  ml = Math.round(ml / 50) * 50;
  return Math.max(1500, Math.min(4500, ml));
}
```

**Пример:**
- Вес 80 кг, рост 175 см, ИМТ = 26.1
- Base: 80 × 30 = 2400 мл
- ИМТ 25–30: +250 → 2650 мл
- Рост ≤ 180: +0 → 2650 мл
- Округление: 2650 мл
- Итого: **2650 мл** = **11 стаканов** (по 250 мл)

#### Один стакан = 250 мл

| Функция | Описание |
|---|---|
| `calculateDailyWaterMl(weight, height, bmi)` | Рекомендуемый объём в мл |
| `getGlassCount(targetMl)` | Количество стаканов (ceil) |
| `getWaterIntake(date?)` | Получить выпитые стаканы (API → кэш → AsyncStorage) |
| `setWaterIntake(glasses, date?, targetMl?)` | Записать потребление |
| `addGlass(date?, targetMl?)` | +1 стакан |
| `removeGlass(date?, targetMl?)` | −1 стакан |
| `getWaterIntakeMulti(dates[])` | Данные за несколько дат (для недельного графика) |

#### Хранение
- **Авторизован:** данные синхронизируются с сервером через `/api/workouts/water`, кэшируются в AsyncStorage
- **Гость:** только AsyncStorage (ключ: `water_intake_YYYY-MM-DD`)

### 5.3. Подсчёт калорий

**Файл:** `data/calories.ts`

Калории рассчитываются **по количеству выполненных подходов** с использованием справочной таблицы.

#### Справочная таблица (фрагмент)

Значения — приблизительные ккал за **один подход** (~10 повторений, ~70 кг человек):

| Упражнение | ккал/подход |
|---|---|
| Бёрпи (burpee) | 12 |
| Становая тяга (deadlift) | 12 |
| Приседания (squat) | 10 |
| Махи гирей (kettlebell-swing) | 10 |
| Жим лёжа (bench-press) | 8 |
| Подтягивания (pull-up) | 8 |
| Жим стоя (overhead-press) | 7 |
| Выпады (lunges) | 7 |
| Подъём на бицепс (barbell-curl) | 5 |
| Разводки (cable-fly) | 5 |
| Планка (plank) | 4 |
| Сгибание запястий (wrist-curl) | 2 |
| **Неизвестное упражнение** | **5** (по умолчанию) |

Полная таблица содержит **100+ упражнений** с индивидуальными значениями.

#### Формулы

$$calories_{exercise} = kcal\_per\_set \times count(completed\_sets)$$

$$calories_{workout} = \sum_{i=1}^{n} calories_{exercise_i}$$

$$calories_{total} = \sum_{j=1}^{m} calories_{workout_j}$$

**Функции:**

| Функция | Описание |
|---|---|
| `getCaloriesPerSet(exerciseId)` | ккал за 1 подход данного упражнения |
| `getExerciseCalories(completedExercise)` | Калории за все подходы упражнения |
| `getWorkoutCalories(workoutLog)` | Калории за всю тренировку |
| `getTotalCalories(logs[])` | Суммарные калории за несколько тренировок |
| `estimateWorkoutCalories(exercises[])` | Оценка калорий (все подходы как выполненные) |

### 5.4. Каталог упражнений

**82 упражнения** на русском языке, разбитые по:

- **10 групп мышц:** грудь, спина, плечи, бицепс, трицепс, ноги, ягодицы, пресс, предплечья, икры
- **7 типов снаряжения:** штанга, гантели, тренажёр, блок, своё тело, гиря, резинки
- **3 уровня сложности:** начинающий, средний, продвинутый

Каждое упражнение содержит:
- Описание на русском
- 5 пошаговых инструкций выполнения
- Привязку к группам мышц (может быть несколько)

**Загрузка:** API → кэш в SQLite → in-memory кэш. Поиск и фильтрация работают и оффлайн.

### 5.5. Создание и выполнение тренировок

#### Создание
1. Ввод названия тренировки
2. Выбор упражнений из каталога (с поиском)
3. Настройка для каждого: кол-во подходов, повторений, время отдыха
4. Сохранение (локально + на сервер)

#### Выполнение (workout/run)
1. Загрузка тренировки и её упражнений
2. Циклы: **упражнение → подходы → отдых → следующее**
3. Для каждого подхода: ввод повторений, отметка выполнения
4. Таймер отдыха с обратным отсчётом
5. По завершении: расчёт калорий, сохранение лога
6. Модалка подтверждения при попытке выхода

### 5.6. Календарь и планирование

- Помесячный календарь с точками (зелёная = тренировка, синяя = запланирована)
- Планирование тренировки на дату + время
- Локальные push-уведомления при наступлении запланированного времени
- Блокировка планирования на прошедшие даты
- Просмотр истории: какие тренировки были выполнены, длительность, калории

### 5.7. Сообщество

- Публикация своих тренировок с заголовком, описанием и сложностью
- Просмотр тренировок других пользователей
- Сортировка: новые, популярные, по просмотрам
- Лайки и счётчик просмотров
- Копирование тренировки себе в один клик

### 5.8. Профиль и настройки

- Редактирование: имя, рост, вес, дата рождения, цель
- Загрузка аватарки с кадрированием (crop)
- Смена пароля
- Переключение темы: системная / светлая / тёмная
- Выход из аккаунта (очистка локальных данных)

### 5.9. Тема и дизайн

**Glass-morphism** стиль с полупрозрачными элементами:

| Параметр | Светлая тема | Тёмная тема |
|---|---|---|
| Фон | `#F5F5FA` | `#0A0A14` |
| Поверхность | `rgba(255,255,255,0.65)` | `rgba(30,30,50,0.7)` |
| Акцент | `#6C63FF` | `#8B83FF` |
| Текст | `#1A1A2E` | `#E8E8F0` |

Плавающий таб-бар (pill-shape, borderRadius: 32, снизу с отступом 16px, тень).

### 5.10. Уведомления

Используется `expo-notifications`:
- Запрос разрешения на push-уведомления
- Планирование локального уведомления на точное время тренировки
- Заголовок: «🏋️ Время тренировки!», текст: «Запланировано: {название}»
- Отмена уведомления при удалении расписания
- Не срабатывает на прошедшие даты

### 5.11. Статистика (дашборд)

На главном экране отображается:
- **Прогресс дня:** выполнено / запланировано тренировок
- **Активность за неделю:** столбчатый график тренировок по дням
- **Калории:** за сегодня, за неделю, средние в день, общие
- **Вода:** прогресс-бар, +/- стаканы, недельный график
- **Прогресс:** серия тренировок подряд (streak), ИМТ, работающие мышцы
- **Тренировки на сегодня:** запланированные и выполненные

Все данные обновляются при каждом возвращении на вкладку «Главное» (useFocusEffect).

---

## 6. UX/UI дизайн

### 6.1. Дизайн-система

#### Визуальный язык: Glassmorphism

Всё приложение построено на принципе **glass-morphism** — полупрозрачные слоистые поверхности с размытием фона, мягкими тенями и лёгкими границами. Каждая карточка, модалка и поверхность использует `rgba`-цвета с прозрачностью.

```
┌─────────────────────────────────────────────────┐
│  Фон (#F0F4F8 / #0F0F1A)                       │
│                                                 │
│   ┌─────────────────────────────────────────┐   │
│   │  GlassCard                              │   │
│   │  background: rgba(255,255,255,0.55)     │   │
│   │  border: rgba(255,255,255,0.25)         │   │
│   │  blur: intensity 40 (expo-blur)         │   │
│   │  borderRadius: 16                       │   │
│   │  shadow: #6C63FF, opacity 0.12          │   │
│   │                                         │   │
│   │   ┌───────────────────────────────┐     │   │
│   │   │  Вложенные элементы           │     │   │
│   │   │  (бейджи, кнопки, текст)      │     │   │
│   │   └───────────────────────────────┘     │   │
│   └─────────────────────────────────────────┘   │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### Цветовая палитра

| Токен | Светлая тема | Тёмная тема | Назначение |
|---|---|---|---|
| `tint` (акцент) | `#6C63FF` | `#8B83FF` | Основной бренд-цвет (индиго) |
| `tintLight` | `rgba(108,99,255,0.12)` | `rgba(139,131,255,0.15)` | Подложки акцентных элементов |
| `background` | `#F0F4F8` | `#0F0F1A` | Фон приложения |
| `surface` | `rgba(255,255,255,0.65)` | `rgba(30,30,50,0.7)` | Основные поверхности |
| `cardBackground` | `rgba(255,255,255,0.55)` | `rgba(30,30,50,0.6)` | Карточки (glassmorphism) |
| `cardBorder` | `rgba(255,255,255,0.25)` | `rgba(255,255,255,0.06)` | Границы карточек |
| `danger` | `#EF4444` | `#F87171` | Деструктивные действия, продвинутый уровень |
| `success` | `#10B981` | `#34D399` | Успех, начинающий уровень |
| `warning` | `#F59E0B` | `#FBBF24` | Предупреждения, калории |
| `text` | `#1A1A2E` | `#F9FAFB` | Основной текст |
| `textSecondary` | `#6B7280` | `#9CA3AF` | Вторичный текст |

Все цвета определены в файле `constants/theme.ts` и доступны через хук `useThemeColor()`.

#### Типографика

Иерархия шрифтов основана на **системных шрифтах** платформы (без внешних шрифтов):

| Роль | Размер | Вес | Где используется |
|---|---|---|---|
| Заголовок экрана | 32 px | 800 | Приветствие на дашборде |
| Заголовок карточки | 17 px | 700 | Название упражнения / тренировки |
| Кнопка | 16 px | 600 | Все кнопки |
| Основной текст | 14–16 px | 400–500 | Описания, подписи |
| Бейдж / метка | 12 px | 600 | Группы мышц, сложность, снаряд |
| Подпись таба | 10 px | 600 | Таб-бар |

#### Система отступов

Базовая единица: **4 px**. Все отступы кратны базовой единице:

| Токен | Значение | Применение |
|---|---|---|
| `xs` | 4 px | Зазоры между бейджами |
| `sm` | 8 px | Внутри компонентов |
| `md` | 12 px | Между элементами в списке |
| `lg` | 16 px | Паддинг карточек, отступы экрана |
| `xl` | 20 px | Паддинг кнопок |
| `xxl` | 24 px | Секции на странице |
| `xxxl` | 32 px | Крупные отступы |

#### Скругления

| Токен | Значение | Применение |
|---|---|---|
| `sm` | 8 px | Бейджи, мелкие элементы |
| `md` | 12 px | Кнопки, поля ввода, карточки |
| `lg` | 16 px | GlassCard, основные карточки |
| `xl` | 20 px | Модальные окна |
| `full` | 999 px | Фильтр-чипы (pill), аватар |

---

### 6.2. Система анимаций

Вся анимация построена на **react-native-reanimated** с приоритетом пружинной физики (`withSpring`) для естественного ощущения движения.

#### Анимационные примитивы

| Компонент | Назначение | Параметры |
|---|---|---|
| `ScalePressable` | Тактильный отклик нажатия | Пружина: `damping 15, stiffness 400` при нажатии; `12, 300` при отпускании. Масштаб до 0.96 |
| `FadeInView` | Анимация появления элемента | Направление (вверх/вниз/влево/вправо), `duration 500ms`, кубическая ease-out для прозрачности, пружина для сдвига |
| `StaggeredItem` | Каскадное появление списка | Обёртка над `FadeInView` с задержкой `index × 80ms` между элементами |
| `PulseView` | Пульсация для CTA-кнопок | Масштаб 1.0 → 1.05, цикл 1200ms, бесконечное повторение |
| `AnimatedCounter` | Анимированная смена чисел | 800ms, кубическая ease-out, 20+ кадров через JS-интервал |
| `ProgressRing` | Кольцевой индикатор прогресса | SVG, `strokeDashoffset`, 1000ms ease-out, `strokeLinecap: round` |
| `ShimmerGlow` | Мягкое мерцание | Прозрачность 0.6 → 1.0, цикл 2000ms |
| `AnimatedTabIcon` | Иконка таб-бара | При фокусе: пружина масштаба до 1.25 → 1.1, сдвиг вверх на 2px |

#### Интро-экран (Splash)

Хореографическая последовательность из **7 анимационных фаз**:

```
   0ms       200ms      500ms      700ms      900ms      1100ms     1500ms     3500ms
    │          │          │          │          │          │          │          │
    ▼          ▼          ▼          ▼          ▼          ▼          ▼          ▼
  Старт    Иконка     Текст     Эмодзи    Линия     Подтекст   Цитата    Fade-out
           scale      fade+     bounce    width     fade+      fade+     opacity
           0→1 +      slideY    0.5→1.3   0→80px    slideY     slideY    → 0
           rotate     30→0      →1.0                20→0       20→0
           -30°→0°
```

**Контекстно-зависимое содержание:** иконка, приветствие и эмодзи меняются в зависимости от времени суток:
- 🌙 «Доброй ночи» (0:00–5:59)
- ☀️ «Доброе утро» (6:00–11:59)
- 💪 «Добрый день» (12:00–17:59)
- 🌅 «Добрый вечер» (18:00–23:59)

Мотивационная цитата выбирается случайно из пула (12 цитат).

---

### 6.3. Компонентная иерархия

UI строится на принципе **атомарной композиции** — простые примитивы комбинируются в сложные компоненты:

```
ScalePressable (тактильный отклик)
  └── GlassCard (полупрозрачная карточка с blur)
        ├── Заголовок (ThemedText, иконка)
        ├── Описание (ThemedText secondary)
        └── Ряд бейджей
              ├── MuscleGroupBadge (tint)
              ├── EquipmentBadge (default)
              ├── DifficultyBadge (success/tint/danger)
              └── CalorieBadge (warning)
```

#### Ключевые UI-компоненты

**GlassCard** — базовая карточка:
- `expo-blur` с интенсивностью 40
- Полупрозрачный фон + тонкая граница
- Вариант `elevated`: тень `#6C63FF` на iOS / `elevation: 6` на Android
- Адаптивный blur tint (светлый/тёмный)

**Button** — 4 варианта:

| Вариант | Фон | Текст | Применение |
|---|---|---|---|
| `primary` | `#6C63FF` | белый | Основные действия |
| `secondary` | `tintLight` (12% акцент) | акцент | Альтернативные действия |
| `danger` | `dangerLight` | красный | Удаление, отмена |
| `ghost` | прозрачный | акцент | Ссылки, текстовые кнопки |

Минимальная высота: 48px (обычный) / 36px (компактный). Поддержка иконки, индикатора загрузки, состояния `disabled`.

**Badge** — 4 семантических варианта:

| Вариант | Фон | Когда |
|---|---|---|
| `default` | `cardBackground` | Снаряжение |
| `tint` | `tintLight` | Группа мышц, средний уровень |
| `success` | `successLight` | Начинающий уровень |
| `danger` | `dangerLight` | Продвинутый уровень |

**ChipFilter** — горизонтальные фильтры:
- Pill-форма (`borderRadius: 999`)
- Выделенный: фон `tint`, текст белый
- Невыделенный: фон `cardBackground`, текст `textSecondary`
- Каждый чип обёрнут в `ScalePressable` (scale 0.92)
- Всегда есть чип «Все» для сброса

**ExerciseCard** — карточка упражнения:
- `ScalePressable` (scale 0.97) → `GlassCard`
- Иконка 42×42 с фоном `tintLight` + название (17px/700) + описание (13px, 2 строки)
- Ряд бейджей: мышцы + снаряд + сложность + калории/подход
- Шеврон справа для навигации

**SearchBar** — поисковая строка:
- Анимированная граница: при фокусе → цвет `tint`, лёгкое масштабирование (1.01×)
- Иконка поиска меняет цвет при фокусе
- Кнопка очистки (×) появляется при наличии текста
- Высота 44px, `borderRadius: 12`

---

### 6.4. Навигация и таб-бар

#### Плавающий таб-бар (Floating Pill Tab Bar)

Физирменный элемент дизайна — **плавающий, pill-образный** таб-бар:

```
┌──────────────────────────────────────────────────────┐
│                                                      │
│              Контент экрана                           │
│                                                      │
│                                                      │
│   ┌──────────────────────────────────────────────┐   │
│   │  🏠    💪    📋    📅    🌍                  │   │  ← borderRadius: 32
│   │ Главное Упр. Трен. Кален. Сообщ.             │   │  ← height: 64
│   └──────────────────────────────────────────────┘   │  ← bottom: 16
│       left: 20                          right: 20    │
└──────────────────────────────────────────────────────┘
```

**Стили:**
- `position: absolute`, `bottom: 16`, `left: 20`, `right: 20`
- `height: 64`, `borderRadius: 32` (идеальная pill-форма = половина высоты)
- Фон: `#1E1E32` (тёмная) / `#FFFFFF` (светлая) — **непрозрачный**
- Тень: `shadowColor: #000`, `shadowOffset: {0, 4}`, `shadowOpacity: 0.25`, `shadowRadius: 12`
- Android: `elevation: 8`
- Без верхней границы (`borderTopWidth: 0`)

**Интерактивность:**
- Каждая иконка обёрнута в `AnimatedTabIcon` — при выборе: пружинный масштаб до 1.25 → 1.1 + сдвиг вверх 2px
- Тактильный отклик (haptic feedback) через `HapticTab` — `ImpactFeedbackStyle.Light` (iOS)
- Подписи: 10px / 600 вес

#### Модальные экраны

| Экран | Тип презентации | Жест закрытия |
|---|---|---|
| `exercise/[id]` | `card` (карточка снизу) | Свайп вниз |
| `workout/create` | модальное окно | Свайп вниз |
| `workout/[id]` | `card` | Свайп вниз |
| `workout/run` | `fullScreenModal` | **Заблокирован** (модалка подтверждения) |
| `profile` | стек (push) | Кнопка назад |

Экран выполнения тренировки (`workout/run`) намеренно использует `fullScreenModal` без возможности свайпа — при попытке выхода показывается модалка подтверждения, чтобы предотвратить случайную потерю прогресса.

---

### 6.5. Иконография

Приложение использует **собственную библиотеку SVG-иконок** (50+ иконок, 554 строки) без внешних icon-pack зависимостей.

**Характеристики:**
- Все иконки — path-based SVG через `react-native-svg`
- Единый интерфейс: `{ size?: number; color?: string }` (по умолчанию `24×24`, `#000`)
- Стиль штриха: `strokeWidth: 1.8–2`, `strokeLinecap: round`, `strokeLinejoin: round`
- Консистентная визуальная плотность

**Категории иконок:**

| Группа | Примеры |
|---|---|
| Навигация | `HomeIcon`, `ChevronRightIcon`, `ChevronLeftIcon`, `CloseIcon` |
| Действия | `PlusIcon`, `TrashIcon`, `EditIcon`, `SearchIcon`, `CopyIcon` |
| Фитнес | `DumbbellIcon`, `FlameIcon`, `TimerIcon`, `RepeatIcon` |
| Профиль | `UserIcon`, `CameraIcon`, `LockIcon`, `LogOutIcon` |
| Погода/время | `SunIcon`, `MoonIcon`, `SunsetIcon` |
| Сообщество | `GlobeIcon`, `HeartIcon`, `EyeIcon`, `ShareIcon` |
| Данные | `ChartIcon`, `DropletIcon`, `CalendarIcon`, `TrophyIcon` |

Дополнительно: `ExerciseIcon` — набор специализированных иконок для каждого упражнения (по id), отображаемых на карточках и детальных экранах.

---

### 6.6. Тёмная и светлая темы

#### Автоматическое переключение

Тема определяется через `useColorScheme()` и может быть переопределена вручную в профиле. Три режима:
- **Системная** — следует за настройками ОС
- **Светлая** — всегда `light`
- **Тёмная** — всегда `dark`

Выбранный режим сохраняется в `AsyncStorage` и применяется через `ThemeContext`.

#### Сравнение тем

```
  Светлая тема                         Тёмная тема
┌─────────────────────┐          ┌─────────────────────┐
│ ░░░░░░░░░░░░░░░░░░░ │ #F0F4F8  │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ │ #0F0F1A
│ ┌─────────────────┐ │          │ ┌─────────────────┐ │
│ │ ░░ Card ░░░░░░░ │ │ 55% wh  │ │ ▓▓ Card ▓▓▓▓▓▓▓ │ │ 60% dk
│ │                 │ │          │ │                 │ │
│ │  ■ Текст #1A1A  │ │          │ │  □ Текст #F9FA  │ │
│ │  ● Акцент 6C63  │ │          │ │  ● Акцент 8B83  │ │
│ └─────────────────┘ │          │ └─────────────────┘ │
└─────────────────────┘          └─────────────────────┘
```

Все цвета являются **семантическими токенами** — компоненты не используют хардкод цветов, а запрашивают нужный токен через `useThemeColor('success')`. Это гарантирует, что любой элемент корректно отображается в обеих темах.

---

### 6.7. Тактильная обратная связь (Haptics)

| Событие | Тип | Платформа |
|---|---|---|
| Нажатие на вкладку | `ImpactFeedbackStyle.Light` | iOS |
| Нажатие на карточку | `ScalePressable` (визуальный) | iOS + Android |
| Нажатие на кнопку | `ScalePressable` (визуальный) | iOS + Android |
| Нажатие на чип-фильтр | `ScalePressable` scale 0.92 | iOS + Android |

На Android тактильная отдача визуальная (масштабирование), на iOS — комбинация визуальной и аппаратной вибрации.

---

### 6.8. UX-паттерны

#### Offline-first UI

- Все данные доступны **мгновенно** из локальной SQLite — нет состояний загрузки при повторных открытиях
- Операции записи выполняются локально, а затем синхронизируются — пользователь не ждёт ответа сервера
- При отсутствии сети приложение продолжает работать без потери функциональности

#### Защита от случайных действий

- **Выход из тренировки:** модалка подтверждения при попытке свайпнуть назад во время выполнения
- **Удаление тренировки:** подтверждение через Alert
- **Выход из аккаунта:** подтверждение перед очисткой локальных данных

#### Обратная связь

- `AnimatedCounter` — числа на дашборде (калории, тренировки) анимированно нарастают, а не появляются мгновенно
- `ProgressRing` — кольцевой прогресс плавно заполняется при загрузке экрана
- `PulseView` — CTA-кнопки мягко пульсируют для привлечения внимания
- Стаггерированное появление списков (80ms между элементами) создаёт эффект «водопада»

#### Кадрирование аватара

Полноэкранная модалка (`#000` фон) с:
- Круглым окном обрезки (72% ширины экрана)
- Жесты: перетаскивание одним пальцем + pinch-to-zoom двумя (масштаб 0.5×–5.0×)
- Маска затемнения вокруг зоны обрезки
- Серверная обработка: обрезка + ресандинг до 400×400 JPEG через Sharp

#### Адаптация контента

- Приветствие на дашборде меняется в зависимости от **времени суток** (утро/день/вечер/ночь)
- Случайная мотивационная цитата при каждом открытии
- Бейджи ИМТ меняют цвет в зависимости от значения (синий → зелёный → жёлтый → красный)
- Прогресс воды визуально заполняется стаканами

---

### 6.9. Принципы дизайна (итого)

| Принцип | Реализация |
|---|---|
| **Glassmorphism** | Полупрозрачные карточки с blur, мягкие тени, слоистость |
| **Пружинная физика** | Все анимации движения через `withSpring` — естественное ощущение |
| **Атомарный дизайн** | Примитивы (Badge, Button) → составные (ExerciseCard, GlassCard) → экраны |
| **Семантические токены** | Ни один компонент не использует хардкод цвета — всё через тему |
| **Mobile-first** | Все элементы рассчитаны на палец (мин. 44–48px touch target) |
| **Консистентность** | Единая система отступов (4px), скруглений и типографики |
| **Тактильность** | Каждое нажатие даёт визуальный (scale) и аппаратный (haptic) отклик |
| **Без внешних шрифтов/иконок** | Системные шрифты + собственные SVG-иконки = минимальный размер бандла |

---

## Развёртывание

| Компонент | Расположение | Процесс |
|---|---|---|
| Backend | Ubuntu 22.04, IP 89.111.171.11 | PM2 (fitapp), Nginx → port 3000 |
| PostgreSQL | Тот же сервер | fitapp DB, user fitapp |
| Лендинг | Beget (trolol8j.beget.tech) | FTP-загрузка HTML/CSS/JS |
| Android APK | EAS Build (preview profile) | `eas build --platform android --profile preview` |
| Android AAB | EAS Build (production profile) | `eas build --platform android --profile production` |

ссылки:
http://trolol8j.beget.tech/ - сайт
https://expo.dev/accounts/rifitgg/projects/EasyFit/builds/505782a7-368a-4c9e-9a68-629a17e51a44 ссылка на мобилку 
https://cloud.reg.ru/panel/servers панель сервера 
